<!doctype html>

<meta charset="utf-8">

<body>

<script src="pixi.min.js"></script>

<script>



var options = {

      preserveDrawingBuffer: false,

      clearBeforeRender :false,

      autoResize: true,

      transparent: false

};



var renderer = new PIXI.WebGLRenderer(800, 600, options);

document.body.appendChild(renderer.view);



var stage = new PIXI.Container();



var videoElement = document.createElement("video");



videoElement.src = "vid25.mp4";

videoElement.type ='video/mp4';


videoElement.setAttribute("muted", true);
videoElement.setAttribute("autoplay", true);
videoElement.setAttribute("loop", true);
videoElement.setAttribute('playsinline', true);
videoElement.muted = true;
videoElement.autoplay = true;
videoElement.loop = true;
videoElement.playsinline = true;









console.assert(videoElement.muted);

//console.assert(videoElement.autoplay);

//console.assert(videoElement.loop);

var oldPlay = videoElement.play;
console.log(oldPlay);
videoElement.play = function (){
  return true;
};

var texture = PIXI.Texture.fromVideo(videoElement);





var videoSprite = new PIXI.Sprite(texture);



videoElement.oncanplaythrough = function () {

    console.log("VID LOADED");

    var promise = oldPlay.call(videoElement);
    console.log(promise);

    if (promise !== undefined) {
        promise.catch(error => {
            var btn = document.createElement("BUTTON");
            document.body.appendChild(btn);
            btn.onclick = oldPlay.bind(videoElement);
        }).then(() => {
            // Auto-play started
            console.log("autoplay success");
        });
    }

    /*setTimeout(() => {

        

    }, 2000);*/

    videoElement.oncanplaythrough = null;

};



var fps = 60;



if(fps !== 60) {

    texture.baseTexture.autoUpdate = false;

    setInterval(() => {

        texture.update();

    }, Math.floor(1000 / fps));

}


stage.addChild(videoSprite);



animate();



function animate(){

    renderer.render(stage);



    requestAnimationFrame(animate);

}




</script>

</body>
